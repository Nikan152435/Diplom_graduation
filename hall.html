<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сеанс</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>

<body class="body">
    <div class="container">
        <header class="header">
            <h1 class="header-content">Идём<span class="letter">в</span>кино</h1>
        </header>

        <main class="main">
            <section class="buying__info">
                <div class="buying__info-description">
                    <!-- Место для отображения информации о фильме -->
                    <h2 class="film__name"></h2> <!-- Название фильма -->
                    <h3 class="film__time">Начало сеанса: </h3> <!-- Время начала сеанса -->
                    <h4 class="hall__number"></h4> <!-- Номер зала -->
                </div>
                <div class="buying__info-hint">
                    <img class="tap__img" src="./images/hint.png" alt="тап">
                    <div class="tap__text">Тапните дважды, чтобы увеличить</div>
                </div>
            </section>

            <section class="buying-scheme">
                <div class="buying-scheme__wrapper">
                    <img class="screen__img" src="./images/screen.png" alt="экран">
                    <div class="places">
                        <!-- Здесь будут отображены места для сеанса -->
                    </div>
                </div>
                <div class="buying-scheme-legend">
                    <div class="left__side">
                        <div class="scheme-info">
                            <img class="chair" src="./images/free.png" alt="свободно">
                            <span class="buying-scheme__chair">Свободно (250руб)</span>
                        </div>
                        <div class="scheme-info">
                            <img class="chair" src="./images/free_vip.png" alt="свободно вип">
                            <span class="buying-scheme__chair">Свободно VIP (350руб)</span>
                        </div>
                    </div>

                    <div class="right__side">
                        <div class="scheme-info">
                            <img class="chair" src="./images/busy.png" alt="занято">
                            <span class="buying-scheme__chair">Занято</span>
                        </div>
                        <div class="scheme-info">
                            <img class="chair" src="./images/selected.png" alt="выбрано">
                            <span class="buying-scheme__chair">Выбрано</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Кнопка для бронирования -->
            <button class="btn">
                <span class="btn-label">Забронировать</span>
            </button>    
        </main>
    </div>

    <!-- Скрипт для обработки страницы -->
    <script src="./js/hall.js"></script>
    <script>
        // Извлечение параметра seance_id из URL
        const urlParams = new URLSearchParams(window.location.search);
        const seanceId = urlParams.get('seance_id');
    
        // Проверяем, что seanceId был успешно получен из URL
        if (seanceId) {
            console.log(`Получен seance_id: ${seanceId}`);
            // Функция для запроса данных о сеансе на сервере
            fetchSeanceData(seanceId);
        } else {
            console.error('seance_id не был передан в URL');
        }
    
        // Функция для получения данных по seanceId с сервера
        async function fetchSeanceData(seanceId) {
            try {
                // Отправляем запрос к серверу, используя seanceId
                const response = await fetch(`http://localhost:9000/seances/${seanceId}`); // Используем HTTP
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                // Получаем данные в формате JSON
                const data = await response.json();

                // Проверяем, что данные были получены и содержат необходимые поля
                if (data && data.filmName && data.startTime && data.hallNumber) {
                    console.log(data); // Выводим данные в консоль

                    // Обновляем элементы на странице данными с сервера
                    document.querySelector('.film__name').textContent = data.filmName; // Название фильма
                    document.querySelector('.film__time').textContent += data.startTime; // Время начала сеанса
                    document.querySelector('.hall__number').textContent = `Зал: ${data.hallNumber}`; // Номер зала
                } else {
                    console.error('Некорректные данные с сервера:', data);
                }

            } catch (error) {
                // Обрабатываем возможные ошибки при запросе
                console.error('Ошибка при получении данных:', error);
            }
        }
    </script>
</body>
</html>